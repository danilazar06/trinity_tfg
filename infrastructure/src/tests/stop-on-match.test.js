"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
(0, globals_1.describe)('Stop-on-Match Algorithm - Property Tests', () => {
    /**
     * Property 2: Stop-on-Match Algorithm Correctness
     * Validates: Requirements 1.3, 1.4
     *
     * Property: The Stop-on-Match algorithm should:
     * 1. Only process LIKE votes, ignore DISLIKE votes
     * 2. Trigger match when currentVotes >= totalMembers
     * 3. Update room status to MATCHED when consensus is reached
     * 4. Never trigger false positives or miss valid matches
     */
    (0, globals_1.describe)('Property 2: Stop-on-Match Algorithm Correctness', () => {
        (0, globals_1.it)('should only process LIKE votes according to algorithm', () => {
            // Test vote type filtering
            const voteTypes = ['LIKE', 'DISLIKE', 'SKIP', 'MAYBE'];
            const processedVotes = voteTypes.filter(voteType => voteType === 'LIKE');
            (0, globals_1.expect)(processedVotes).toEqual(['LIKE']);
            (0, globals_1.expect)(processedVotes.length).toBe(1);
            // Verify DISLIKE votes are ignored
            const dislikeVotes = voteTypes.filter(voteType => voteType === 'DISLIKE');
            (0, globals_1.expect)(dislikeVotes).toEqual(['DISLIKE']);
            // But they should not be processed
            const shouldProcessDislike = false; // According to Stop-on-Match
            (0, globals_1.expect)(shouldProcessDislike).toBe(false);
        });
        (0, globals_1.it)('should trigger match when consensus is reached', () => {
            // Test various consensus scenarios
            const testCases = [
                // [currentVotes, totalMembers, shouldMatch]
                [1, 1, true],
                [2, 2, true],
                [3, 3, true],
                [5, 5, true],
                [1, 2, false],
                [2, 3, false],
                [4, 5, false],
                [0, 1, false],
                [0, 0, false], // Edge case: no members
            ];
            testCases.forEach(([currentVotes, totalMembers, shouldMatch]) => {
                const votes = currentVotes;
                const members = totalMembers;
                const expected = shouldMatch;
                const hasConsensus = votes >= members && members > 0;
                (0, globals_1.expect)(hasConsensus).toBe(expected);
            });
        });
        (0, globals_1.it)('should handle edge cases correctly', () => {
            // Test edge cases for the algorithm
            const edgeCases = [
                { currentVotes: 0, totalMembers: 0, expected: false, description: 'No members in room' },
                { currentVotes: 1, totalMembers: 0, expected: false, description: 'More votes than members (data inconsistency)' },
                { currentVotes: -1, totalMembers: 1, expected: false, description: 'Negative vote count' },
                { currentVotes: 1, totalMembers: -1, expected: false, description: 'Negative member count' },
            ];
            edgeCases.forEach(({ currentVotes, totalMembers, expected, description }) => {
                const hasConsensus = currentVotes >= totalMembers &&
                    totalMembers > 0 &&
                    currentVotes >= 0;
                (0, globals_1.expect)(hasConsensus).toBe(expected);
            });
        });
        (0, globals_1.it)('should validate room status transitions', () => {
            // Test valid room status transitions for Stop-on-Match
            const validTransitions = [
                { from: 'WAITING', to: 'ACTIVE', valid: true },
                { from: 'ACTIVE', to: 'MATCHED', valid: true },
                { from: 'WAITING', to: 'MATCHED', valid: true },
                { from: 'MATCHED', to: 'ACTIVE', valid: false },
                { from: 'COMPLETED', to: 'MATCHED', valid: false },
                { from: 'PAUSED', to: 'MATCHED', valid: false }, // Should not match when paused
            ];
            validTransitions.forEach(({ from, to, valid }) => {
                let isValidTransition = false;
                if (to === 'MATCHED') {
                    // Only allow transitions to MATCHED from WAITING or ACTIVE
                    isValidTransition = from === 'WAITING' || from === 'ACTIVE';
                }
                else if (to === 'ACTIVE') {
                    // Allow transitions to ACTIVE from WAITING
                    isValidTransition = from === 'WAITING';
                }
                (0, globals_1.expect)(isValidTransition).toBe(valid);
            });
        });
        (0, globals_1.it)('should maintain vote count consistency', () => {
            // Test vote count increment logic
            const scenarios = [
                { initialVotes: 0, increment: 1, expected: 1 },
                { initialVotes: 1, increment: 1, expected: 2 },
                { initialVotes: 5, increment: 1, expected: 6 },
                { initialVotes: 0, increment: 0, expected: 0 }, // No vote case
            ];
            scenarios.forEach(({ initialVotes, increment, expected }) => {
                const newVoteCount = initialVotes + increment;
                (0, globals_1.expect)(newVoteCount).toBe(expected);
                (0, globals_1.expect)(newVoteCount).toBeGreaterThanOrEqual(initialVotes);
            });
        });
        (0, globals_1.it)('should validate atomic vote operations', () => {
            // Test that vote operations are atomic (all or nothing)
            const voteOperations = [
                'validateRoom',
                'validateMembership',
                'preventDuplicate',
                'incrementCount',
                'checkConsensus',
                'updateRoomStatus'
            ];
            // All operations must succeed for a valid vote
            const allOperationsSucceed = voteOperations.every(op => op.length > 0);
            (0, globals_1.expect)(allOperationsSucceed).toBe(true);
            // If any operation fails, the entire vote should fail
            const someOperationFails = voteOperations.some(op => op === '');
            (0, globals_1.expect)(someOperationFails).toBe(false);
        });
        (0, globals_1.it)('should handle concurrent voting scenarios', () => {
            // Test concurrent vote handling logic
            const concurrentScenarios = [
                {
                    description: 'Two users vote simultaneously for same movie',
                    user1Vote: 'LIKE',
                    user2Vote: 'LIKE',
                    totalMembers: 2,
                    expectedResult: 'MATCHED'
                },
                {
                    description: 'One likes, one dislikes (dislike ignored)',
                    user1Vote: 'LIKE',
                    user2Vote: 'DISLIKE',
                    totalMembers: 2,
                    expectedResult: 'ACTIVE' // Only LIKE counts
                },
                {
                    description: 'All users dislike (all ignored)',
                    user1Vote: 'DISLIKE',
                    user2Vote: 'DISLIKE',
                    totalMembers: 2,
                    expectedResult: 'ACTIVE' // No LIKE votes
                }
            ];
            concurrentScenarios.forEach(({ user1Vote, user2Vote, totalMembers, expectedResult }) => {
                const likeVotes = [user1Vote, user2Vote].filter(vote => vote === 'LIKE').length;
                const hasMatch = likeVotes >= totalMembers;
                const status = hasMatch ? 'MATCHED' : 'ACTIVE';
                (0, globals_1.expect)(status).toBe(expectedResult);
            });
        });
        (0, globals_1.it)('should validate movie progression logic', () => {
            // Test movie queue progression in Stop-on-Match
            const movieQueue = ['movie1', 'movie2', 'movie3', 'movie4'];
            let currentIndex = 0;
            // Simulate voting through queue
            const voteResults = [
                { movieId: 'movie1', result: 'NO_MATCH' },
                { movieId: 'movie2', result: 'NO_MATCH' },
                { movieId: 'movie3', result: 'MATCH' },
                // movie4 should not be reached due to match
            ];
            voteResults.forEach(({ movieId, result }) => {
                (0, globals_1.expect)(movieQueue[currentIndex]).toBe(movieId);
                if (result === 'MATCH') {
                    // Stop progression on match
                    return;
                }
                else {
                    // Continue to next movie
                    currentIndex++;
                }
            });
            // Verify we stopped at the matched movie
            (0, globals_1.expect)(currentIndex).toBe(2); // Index of movie3
            (0, globals_1.expect)(movieQueue[currentIndex]).toBe('movie3');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcC1vbi1tYXRjaC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3RvcC1vbi1tYXRjaC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkNBQXFEO0FBRXJELElBQUEsa0JBQVEsRUFBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7SUFDeEQ7Ozs7Ozs7OztPQVNHO0lBQ0gsSUFBQSxrQkFBUSxFQUFDLGlEQUFpRCxFQUFFLEdBQUcsRUFBRTtRQUMvRCxJQUFBLFlBQUUsRUFBQyx1REFBdUQsRUFBRSxHQUFHLEVBQUU7WUFDL0QsMkJBQTJCO1lBQzNCLE1BQU0sU0FBUyxHQUFHLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDdkQsTUFBTSxjQUFjLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsS0FBSyxNQUFNLENBQUMsQ0FBQztZQUV6RSxJQUFBLGdCQUFNLEVBQUMsY0FBYyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN6QyxJQUFBLGdCQUFNLEVBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUV0QyxtQ0FBbUM7WUFDbkMsTUFBTSxZQUFZLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsS0FBSyxTQUFTLENBQUMsQ0FBQztZQUMxRSxJQUFBLGdCQUFNLEVBQUMsWUFBWSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUUxQyxtQ0FBbUM7WUFDbkMsTUFBTSxvQkFBb0IsR0FBRyxLQUFLLENBQUMsQ0FBQyw2QkFBNkI7WUFDakUsSUFBQSxnQkFBTSxFQUFDLG9CQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNDLENBQUMs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LFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XHJcblxyXG5kZXNjcmliZSgnU3RvcC1vbi1NYXRjaCBBbGdvcml0aG0gLSBQcm9wZXJ0eSBUZXN0cycsICgpID0+IHtcclxuICAvKipcclxuICAgKiBQcm9wZXJ0eSAyOiBTdG9wLW9uLU1hdGNoIEFsZ29yaXRobSBDb3JyZWN0bmVzc1xyXG4gICAqIFZhbGlkYXRlczogUmVxdWlyZW1lbnRzIDEuMywgMS40XHJcbiAgICogXHJcbiAgICogUHJvcGVydHk6IFRoZSBTdG9wLW9uLU1hdGNoIGFsZ29yaXRobSBzaG91bGQ6XHJcbiAgICogMS4gT25seSBwcm9jZXNzIExJS0Ugdm90ZXMsIGlnbm9yZSBESVNMSUtFIHZvdGVzXHJcbiAgICogMi4gVHJpZ2dlciBtYXRjaCB3aGVuIGN1cnJlbnRWb3RlcyA+PSB0b3RhbE1lbWJlcnNcclxuICAgKiAzLiBVcGRhdGUgcm9vbSBzdGF0dXMgdG8gTUFUQ0hFRCB3aGVuIGNvbnNlbnN1cyBpcyByZWFjaGVkXHJcbiAgICogNC4gTmV2ZXIgdHJpZ2dlciBmYWxzZSBwb3NpdGl2ZXMgb3IgbWlzcyB2YWxpZCBtYXRjaGVzXHJcbiAgICovXHJcbiAgZGVzY3JpYmUoJ1Byb3BlcnR5IDI6IFN0b3Atb24tTWF0Y2ggQWxnb3JpdGhtIENvcnJlY3RuZXNzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBvbmx5IHByb2Nlc3MgTElLRSB2b3RlcyBhY2NvcmRpbmcgdG8gYWxnb3JpdGhtJywgKCkgPT4ge1xyXG4gICAgICAvLyBUZXN0IHZvdGUgdHlwZSBmaWx0ZXJpbmdcclxuICAgICAgY29uc3Qgdm90ZVR5cGVzID0gWydMSUtFJywgJ0RJU0xJS0UnLCAnU0tJUCcsICdNQVlCRSddO1xyXG4gICAgICBjb25zdCBwcm9jZXNzZWRWb3RlcyA9IHZvdGVUeXBlcy5maWx0ZXIodm90ZVR5cGUgPT4gdm90ZVR5cGUgPT09ICdMSUtFJyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocHJvY2Vzc2VkVm90ZXMpLnRvRXF1YWwoWydMSUtFJ10pO1xyXG4gICAgICBleHBlY3QocHJvY2Vzc2VkVm90ZXMubGVuZ3RoKS50b0JlKDEpO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZ5IERJU0xJS0Ugdm90ZXMgYXJlIGlnbm9yZWRcclxuICAgICAgY29uc3QgZGlzbGlrZVZvdGVzID0gdm90ZVR5cGVzLmZpbHRlcih2b3RlVHlwZSA9PiB2b3RlVHlwZSA9PT0gJ0RJU0xJS0UnKTtcclxuICAgICAgZXhwZWN0KGRpc2xpa2VWb3RlcykudG9FcXVhbChbJ0RJU0xJS0UnXSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBCdXQgdGhleSBzaG91bGQgbm90IGJlIHByb2Nlc3NlZFxyXG4gICAgICBjb25zdCBzaG91bGRQcm9jZXNzRGlzbGlrZSA9IGZhbHNlOyAvLyBBY2NvcmRpbmcgdG8gU3RvcC1vbi1NYXRjaFxyXG4gICAgICBleHBlY3Qoc2hvdWxkUHJvY2Vzc0Rpc2xpa2UpLnRvQmUoZmFsc2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0cmlnZ2VyIG1hdGNoIHdoZW4gY29uc2Vuc3VzIGlzIHJlYWNoZWQnLCAoKSA9PiB7XHJcbiAgICAgIC8vIFRlc3QgdmFyaW91cyBjb25zZW5zdXMgc2NlbmFyaW9zXHJcbiAgICAgIGNvbnN0IHRlc3RDYXNlcyA9IFtcclxuICAgICAgICAvLyBbY3VycmVudFZvdGVzLCB0b3RhbE1lbWJlcnMsIHNob3VsZE1hdGNoXVxyXG4gICAgICAgIFsxLCAxLCB0cnVlXSwgICAvLyBTaW5nbGUgdXNlciBsaWtlc1xyXG4gICAgICAgIFsyLCAyLCB0cnVlXSwgICAvLyBCb3RoIHVzZXJzIGxpa2VcclxuICAgICAgICBbMywgMywgdHJ1ZV0sICAgLy8gQWxsIHRocmVlIHVzZXJzIGxpa2VcclxuICAgICAgICBbNSwgNSwgdHJ1ZV0sICAgLy8gQWxsIGZpdmUgdXNlcnMgbGlrZVxyXG4gICAgICAgIFsxLCAyLCBmYWxzZV0sICAvLyBPbmx5IG9uZSBvZiB0d28gbGlrZXNcclxuICAgICAgICBbMiwgMywgZmFsc2VdLCAgLy8gT25seSB0d28gb2YgdGhyZWUgbGlrZVxyXG4gICAgICAgIFs0LCA1LCBmYWxzZV0sICAvLyBPbmx5IGZvdXIgb2YgZml2ZSBsaWtlXHJcbiAgICAgICAgWzAsIDEsIGZhbHNlXSwgIC8vIE5vIHZvdGVzIHlldFxyXG4gICAgICAgIFswLCAwLCBmYWxzZV0sICAvLyBFZGdlIGNhc2U6IG5vIG1lbWJlcnNcclxuICAgICAgXTtcclxuICAgICAgXHJcbiAgICAgIHRlc3RDYXNlcy5mb3JFYWNoKChbY3VycmVudFZvdGVzLCB0b3RhbE1lbWJlcnMsIHNob3VsZE1hdGNoXSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHZvdGVzID0gY3VycmVudFZvdGVzIGFzIG51bWJlcjtcclxuICAgICAgICBjb25zdCBtZW1iZXJzID0gdG90YWxNZW1iZXJzIGFzIG51bWJlcjtcclxuICAgICAgICBjb25zdCBleHBlY3RlZCA9IHNob3VsZE1hdGNoIGFzIGJvb2xlYW47XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgaGFzQ29uc2Vuc3VzID0gdm90ZXMgPj0gbWVtYmVycyAmJiBtZW1iZXJzID4gMDtcclxuICAgICAgICBleHBlY3QoaGFzQ29uc2Vuc3VzKS50b0JlKGV4cGVjdGVkKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlZGdlIGNhc2VzIGNvcnJlY3RseScsICgpID0+IHtcclxuICAgICAgLy8gVGVzdCBlZGdlIGNhc2VzIGZvciB0aGUgYWxnb3JpdGhtXHJcbiAgICAgIGNvbnN0IGVkZ2VDYXNlcyA9IFtcclxuICAgICAgICB7IGN1cnJlbnRWb3RlczogMCwgdG90YWxNZW1iZXJzOiAwLCBleHBlY3RlZDogZmFsc2UsIGRlc2NyaXB0aW9uOiAnTm8gbWVtYmVycyBpbiByb29tJyB9LFxyXG4gICAgICAgIHsgY3VycmVudFZvdGVzOiAxLCB0b3RhbE1lbWJlcnM6IDAsIGV4cGVjdGVkOiBmYWxzZSwgZGVzY3JpcHRpb246ICdNb3JlIHZvdGVzIHRoYW4gbWVtYmVycyAoZGF0YSBpbmNvbnNpc3RlbmN5KScgfSxcclxuICAgICAgICB7IGN1cnJlbnRWb3RlczogLTEsIHRvdGFsTWVtYmVyczogMSwgZXhwZWN0ZWQ6IGZhbHNlLCBkZXNjcmlwdGlvbjogJ05lZ2F0aXZlIHZvdGUgY291bnQnIH0sXHJcbiAgICAgICAgeyBjdXJyZW50Vm90ZXM6IDEsIHRvdGFsTWVtYmVyczogLTEsIGV4cGVjdGVkOiBmYWxzZSwgZGVzY3JpcHRpb246ICdOZWdhdGl2ZSBtZW1iZXIgY291bnQnIH0sXHJcbiAgICAgIF07XHJcbiAgICAgIFxyXG4gICAgICBlZGdlQ2FzZXMuZm9yRWFjaCgoeyBjdXJyZW50Vm90ZXMsIHRvdGFsTWVtYmVycywgZXhwZWN0ZWQsIGRlc2NyaXB0aW9uIH0pID0+IHtcclxuICAgICAgICBjb25zdCBoYXNDb25zZW5zdXMgPSBjdXJyZW50Vm90ZXMgPj0gdG90YWxNZW1iZXJzICYmIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxNZW1iZXJzID4gMCAmJiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWb3RlcyA+PSAwO1xyXG4gICAgICAgIGV4cGVjdChoYXNDb25zZW5zdXMpLnRvQmUoZXhwZWN0ZWQpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcm9vbSBzdGF0dXMgdHJhbnNpdGlvbnMnLCAoKSA9PiB7XHJcbiAgICAgIC8vIFRlc3QgdmFsaWQgcm9vbSBzdGF0dXMgdHJhbnNpdGlvbnMgZm9yIFN0b3Atb24tTWF0Y2hcclxuICAgICAgY29uc3QgdmFsaWRUcmFuc2l0aW9ucyA9IFtcclxuICAgICAgICB7IGZyb206ICdXQUlUSU5HJywgdG86ICdBQ1RJVkUnLCB2YWxpZDogdHJ1ZSB9LFxyXG4gICAgICAgIHsgZnJvbTogJ0FDVElWRScsIHRvOiAnTUFUQ0hFRCcsIHZhbGlkOiB0cnVlIH0sXHJcbiAgICAgICAgeyBmcm9tOiAnV0FJVElORycsIHRvOiAnTUFUQ0hFRCcsIHZhbGlkOiB0cnVlIH0sIC8vIERpcmVjdCBtYXRjaFxyXG4gICAgICAgIHsgZnJvbTogJ01BVENIRUQnLCB0bzogJ0FDVElWRScsIHZhbGlkOiBmYWxzZSB9LCAvLyBDYW5ub3QgZ28gYmFja1xyXG4gICAgICAgIHsgZnJvbTogJ0NPTVBMRVRFRCcsIHRvOiAnTUFUQ0hFRCcsIHZhbGlkOiBmYWxzZSB9LCAvLyBDYW5ub3QgcmV2ZXJ0XHJcbiAgICAgICAgeyBmcm9tOiAnUEFVU0VEJywgdG86ICdNQVRDSEVEJywgdmFsaWQ6IGZhbHNlIH0sIC8vIFNob3VsZCBub3QgbWF0Y2ggd2hlbiBwYXVzZWRcclxuICAgICAgXTtcclxuICAgICAgXHJcbiAgICAgIHZhbGlkVHJhbnNpdGlvbnMuZm9yRWFjaCgoeyBmcm9tLCB0bywgdmFsaWQgfSkgPT4ge1xyXG4gICAgICAgIGxldCBpc1ZhbGlkVHJhbnNpdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICh0byA9PT0gJ01BVENIRUQnKSB7XHJcbiAgICAgICAgICAvLyBPbmx5IGFsbG93IHRyYW5zaXRpb25zIHRvIE1BVENIRUQgZnJvbSBXQUlUSU5HIG9yIEFDVElWRVxyXG4gICAgICAgICAgaXNWYWxpZFRyYW5zaXRpb24gPSBmcm9tID09PSAnV0FJVElORycgfHwgZnJvbSA9PT0gJ0FDVElWRSc7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0byA9PT0gJ0FDVElWRScpIHtcclxuICAgICAgICAgIC8vIEFsbG93IHRyYW5zaXRpb25zIHRvIEFDVElWRSBmcm9tIFdBSVRJTkdcclxuICAgICAgICAgIGlzVmFsaWRUcmFuc2l0aW9uID0gZnJvbSA9PT0gJ1dBSVRJTkcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBleHBlY3QoaXNWYWxpZFRyYW5zaXRpb24pLnRvQmUodmFsaWQpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gdm90ZSBjb3VudCBjb25zaXN0ZW5jeScsICgpID0+IHtcclxuICAgICAgLy8gVGVzdCB2b3RlIGNvdW50IGluY3JlbWVudCBsb2dpY1xyXG4gICAgICBjb25zdCBzY2VuYXJpb3MgPSBbXHJcbiAgICAgICAgeyBpbml0aWFsVm90ZXM6IDAsIGluY3JlbWVudDogMSwgZXhwZWN0ZWQ6IDEgfSxcclxuICAgICAgICB7IGluaXRpYWxWb3RlczogMSwgaW5jcmVtZW50OiAxLCBleHBlY3RlZDogMiB9LFxyXG4gICAgICAgIHsgaW5pdGlhbFZvdGVzOiA1LCBpbmNyZW1lbnQ6IDEsIGV4cGVjdGVkOiA2IH0sXHJcbiAgICAgICAgeyBpbml0aWFsVm90ZXM6IDAsIGluY3JlbWVudDogMCwgZXhwZWN0ZWQ6IDAgfSwgLy8gTm8gdm90ZSBjYXNlXHJcbiAgICAgIF07XHJcbiAgICAgIFxyXG4gICAgICBzY2VuYXJpb3MuZm9yRWFjaCgoeyBpbml0aWFsVm90ZXMsIGluY3JlbWVudCwgZXhwZWN0ZWQgfSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld1ZvdGVDb3VudCA9IGluaXRpYWxWb3RlcyArIGluY3JlbWVudDtcclxuICAgICAgICBleHBlY3QobmV3Vm90ZUNvdW50KS50b0JlKGV4cGVjdGVkKTtcclxuICAgICAgICBleHBlY3QobmV3Vm90ZUNvdW50KS50b0JlR3JlYXRlclRoYW5PckVxdWFsKGluaXRpYWxWb3Rlcyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhdG9taWMgdm90ZSBvcGVyYXRpb25zJywgKCkgPT4ge1xyXG4gICAgICAvLyBUZXN0IHRoYXQgdm90ZSBvcGVyYXRpb25zIGFyZSBhdG9taWMgKGFsbCBvciBub3RoaW5nKVxyXG4gICAgICBjb25zdCB2b3RlT3BlcmF0aW9ucyA9IFtcclxuICAgICAgICAndmFsaWRhdGVSb29tJyxcclxuICAgICAgICAndmFsaWRhdGVNZW1iZXJzaGlwJywgXHJcbiAgICAgICAgJ3ByZXZlbnREdXBsaWNhdGUnLFxyXG4gICAgICAgICdpbmNyZW1lbnRDb3VudCcsXHJcbiAgICAgICAgJ2NoZWNrQ29uc2Vuc3VzJyxcclxuICAgICAgICAndXBkYXRlUm9vbVN0YXR1cydcclxuICAgICAgXTtcclxuICAgICAgXHJcbiAgICAgIC8vIEFsbCBvcGVyYXRpb25zIG11c3Qgc3VjY2VlZCBmb3IgYSB2YWxpZCB2b3RlXHJcbiAgICAgIGNvbnN0IGFsbE9wZXJhdGlvbnNTdWNjZWVkID0gdm90ZU9wZXJhdGlvbnMuZXZlcnkob3AgPT4gb3AubGVuZ3RoID4gMCk7XHJcbiAgICAgIGV4cGVjdChhbGxPcGVyYXRpb25zU3VjY2VlZCkudG9CZSh0cnVlKTtcclxuICAgICAgXHJcbiAgICAgIC8vIElmIGFueSBvcGVyYXRpb24gZmFpbHMsIHRoZSBlbnRpcmUgdm90ZSBzaG91bGQgZmFpbFxyXG4gICAgICBjb25zdCBzb21lT3BlcmF0aW9uRmFpbHMgPSB2b3RlT3BlcmF0aW9ucy5zb21lKG9wID0+IG9wID09PSAnJyk7XHJcbiAgICAgIGV4cGVjdChzb21lT3BlcmF0aW9uRmFpbHMpLnRvQmUoZmFsc2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCB2b3Rpbmcgc2NlbmFyaW9zJywgKCkgPT4ge1xyXG4gICAgICAvLyBUZXN0IGNvbmN1cnJlbnQgdm90ZSBoYW5kbGluZyBsb2dpY1xyXG4gICAgICBjb25zdCBjb25jdXJyZW50U2NlbmFyaW9zID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVHdvIHVzZXJzIHZvdGUgc2ltdWx0YW5lb3VzbHkgZm9yIHNhbWUgbW92aWUnLFxyXG4gICAgICAgICAgdXNlcjFWb3RlOiAnTElLRScsXHJcbiAgICAgICAgICB1c2VyMlZvdGU6ICdMSUtFJywgXHJcbiAgICAgICAgICB0b3RhbE1lbWJlcnM6IDIsXHJcbiAgICAgICAgICBleHBlY3RlZFJlc3VsdDogJ01BVENIRUQnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ09uZSBsaWtlcywgb25lIGRpc2xpa2VzIChkaXNsaWtlIGlnbm9yZWQpJyxcclxuICAgICAgICAgIHVzZXIxVm90ZTogJ0xJS0UnLFxyXG4gICAgICAgICAgdXNlcjJWb3RlOiAnRElTTElLRScsXHJcbiAgICAgICAgICB0b3RhbE1lbWJlcnM6IDIsXHJcbiAgICAgICAgICBleHBlY3RlZFJlc3VsdDogJ0FDVElWRScgLy8gT25seSBMSUtFIGNvdW50c1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdBbGwgdXNlcnMgZGlzbGlrZSAoYWxsIGlnbm9yZWQpJyxcclxuICAgICAgICAgIHVzZXIxVm90ZTogJ0RJU0xJS0UnLFxyXG4gICAgICAgICAgdXNlcjJWb3RlOiAnRElTTElLRScsXHJcbiAgICAgICAgICB0b3RhbE1lbWJlcnM6IDIsXHJcbiAgICAgICAgICBleHBlY3RlZFJlc3VsdDogJ0FDVElWRScgLy8gTm8gTElLRSB2b3Rlc1xyXG4gICAgICAgIH1cclxuICAgICAgXTtcclxuICAgICAgXHJcbiAgICAgIGNvbmN1cnJlbnRTY2VuYXJpb3MuZm9yRWFjaCgoeyB1c2VyMVZvdGUsIHVzZXIyVm90ZSwgdG90YWxNZW1iZXJzLCBleHBlY3RlZFJlc3VsdCB9KSA9PiB7XHJcbiAgICAgICAgY29uc3QgbGlrZVZvdGVzID0gW3VzZXIxVm90ZSwgdXNlcjJWb3RlXS5maWx0ZXIodm90ZSA9PiB2b3RlID09PSAnTElLRScpLmxlbmd0aDtcclxuICAgICAgICBjb25zdCBoYXNNYXRjaCA9IGxpa2VWb3RlcyA+PSB0b3RhbE1lbWJlcnM7XHJcbiAgICAgICAgY29uc3Qgc3RhdHVzID0gaGFzTWF0Y2ggPyAnTUFUQ0hFRCcgOiAnQUNUSVZFJztcclxuICAgICAgICBcclxuICAgICAgICBleHBlY3Qoc3RhdHVzKS50b0JlKGV4cGVjdGVkUmVzdWx0KTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIG1vdmllIHByb2dyZXNzaW9uIGxvZ2ljJywgKCkgPT4ge1xyXG4gICAgICAvLyBUZXN0IG1vdmllIHF1ZXVlIHByb2dyZXNzaW9uIGluIFN0b3Atb24tTWF0Y2hcclxuICAgICAgY29uc3QgbW92aWVRdWV1ZSA9IFsnbW92aWUxJywgJ21vdmllMicsICdtb3ZpZTMnLCAnbW92aWU0J107XHJcbiAgICAgIGxldCBjdXJyZW50SW5kZXggPSAwO1xyXG4gICAgICBcclxuICAgICAgLy8gU2ltdWxhdGUgdm90aW5nIHRocm91Z2ggcXVldWVcclxuICAgICAgY29uc3Qgdm90ZVJlc3VsdHMgPSBbXHJcbiAgICAgICAgeyBtb3ZpZUlkOiAnbW92aWUxJywgcmVzdWx0OiAnTk9fTUFUQ0gnIH0sXHJcbiAgICAgICAgeyBtb3ZpZUlkOiAnbW92aWUyJywgcmVzdWx0OiAnTk9fTUFUQ0gnIH0sXHJcbiAgICAgICAgeyBtb3ZpZUlkOiAnbW92aWUzJywgcmVzdWx0OiAnTUFUQ0gnIH0sXHJcbiAgICAgICAgLy8gbW92aWU0IHNob3VsZCBub3QgYmUgcmVhY2hlZCBkdWUgdG8gbWF0Y2hcclxuICAgICAgXTtcclxuICAgICAgXHJcbiAgICAgIHZvdGVSZXN1bHRzLmZvckVhY2goKHsgbW92aWVJZCwgcmVzdWx0IH0pID0+IHtcclxuICAgICAgICBleHBlY3QobW92aWVRdWV1ZVtjdXJyZW50SW5kZXhdKS50b0JlKG1vdmllSWQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChyZXN1bHQgPT09ICdNQVRDSCcpIHtcclxuICAgICAgICAgIC8vIFN0b3AgcHJvZ3Jlc3Npb24gb24gbWF0Y2hcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gQ29udGludWUgdG8gbmV4dCBtb3ZpZVxyXG4gICAgICAgICAgY3VycmVudEluZGV4Kys7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFZlcmlmeSB3ZSBzdG9wcGVkIGF0IHRoZSBtYXRjaGVkIG1vdmllXHJcbiAgICAgIGV4cGVjdChjdXJyZW50SW5kZXgpLnRvQmUoMik7IC8vIEluZGV4IG9mIG1vdmllM1xyXG4gICAgICBleHBlY3QobW92aWVRdWV1ZVtjdXJyZW50SW5kZXhdKS50b0JlKCdtb3ZpZTMnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXX0=