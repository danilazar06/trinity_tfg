"use strict";
/**
 * CloudWatch Metrics and Monitoring Utilities
 * Provides structured logging and metrics for production monitoring
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.logCacheMetric = exports.PerformanceTimer = exports.logError = exports.logBusinessMetric = exports.logCircuitBreakerMetric = exports.logPerformance = exports.logMetric = void 0;
/**
 * Log structured metrics for CloudWatch
 */
function logMetric(metric) {
    const logEntry = {
        timestamp: metric.timestamp?.toISOString() || new Date().toISOString(),
        metricType: 'CUSTOM_METRIC',
        metricName: metric.metricName,
        value: metric.value,
        unit: metric.unit,
        dimensions: metric.dimensions || {},
    };
    console.log(`üìä METRIC: ${JSON.stringify(logEntry)}`);
}
exports.logMetric = logMetric;
/**
 * Log performance metrics
 */
function logPerformance(perf) {
    const logEntry = {
        timestamp: new Date().toISOString(),
        metricType: 'PERFORMANCE',
        operation: perf.operation,
        duration: perf.duration,
        success: perf.success,
        errorType: perf.errorType,
        metadata: perf.metadata || {},
    };
    console.log(`‚ö° PERFORMANCE: ${JSON.stringify(logEntry)}`);
    // Also log as CloudWatch metric
    logMetric({
        metricName: `${perf.operation}_Duration`,
        value: perf.duration,
        unit: 'Milliseconds',
        dimensions: {
            Operation: perf.operation,
            Success: perf.success.toString(),
            ErrorType: perf.errorType || 'None'
        }
    });
}
exports.logPerformance = logPerformance;
/**
 * Circuit Breaker metrics
 */
function logCircuitBreakerMetric(service, state, failureCount, successCount) {
    logMetric({
        metricName: 'CircuitBreaker_State',
        value: state === 'OPEN' ? 1 : 0,
        unit: 'Count',
        dimensions: {
            Service: service,
            State: state
        }
    });
    logMetric({
        metricName: 'CircuitBreaker_FailureCount',
        value: failureCount,
        unit: 'Count',
        dimensions: {
            Service: service
        }
    });
    logMetric({
        metricName: 'CircuitBreaker_SuccessCount',
        value: successCount,
        unit: 'Count',
        dimensions: {
            Service: service
        }
    });
}
exports.logCircuitBreakerMetric = logCircuitBreakerMetric;
/**
 * Business metrics for Trinity
 */
function logBusinessMetric(eventType, roomId, userId, metadata) {
    const logEntry = {
        timestamp: new Date().toISOString(),
        metricType: 'BUSINESS_EVENT',
        eventType,
        roomId: roomId || 'unknown',
        userId: userId || 'unknown',
        metadata: metadata || {},
    };
    console.log(`üíº BUSINESS: ${JSON.stringify(logEntry)}`);
    // Log as CloudWatch metric
    logMetric({
        metricName: `Business_${eventType}`,
        value: 1,
        unit: 'Count',
        dimensions: {
            EventType: eventType,
            Stage: process.env.STAGE || 'dev'
        }
    });
}
exports.logBusinessMetric = logBusinessMetric;
/**
 * Error tracking
 */
function logError(operation, error, context) {
    const logEntry = {
        timestamp: new Date().toISOString(),
        metricType: 'ERROR',
        operation,
        errorName: error.name,
        errorMessage: error.message,
        errorStack: error.stack,
        context: context || {},
    };
    console.error(`‚ùå ERROR: ${JSON.stringify(logEntry)}`);
    // Log as CloudWatch metric
    logMetric({
        metricName: 'Errors',
        value: 1,
        unit: 'Count',
        dimensions: {
            Operation: operation,
            ErrorType: error.name,
            Stage: process.env.STAGE || 'dev'
        }
    });
}
exports.logError = logError;
/**
 * Performance timer utility
 */
class PerformanceTimer {
    constructor(operation) {
        this.operation = operation;
        this.startTime = Date.now();
    }
    finish(success = true, errorType, metadata) {
        const duration = Date.now() - this.startTime;
        logPerformance({
            operation: this.operation,
            duration,
            success,
            errorType,
            metadata
        });
    }
}
exports.PerformanceTimer = PerformanceTimer;
/**
 * Cache hit/miss metrics
 */
function logCacheMetric(cacheType, hit, key) {
    logMetric({
        metricName: `Cache_${hit ? 'Hit' : 'Miss'}`,
        value: 1,
        unit: 'Count',
        dimensions: {
            CacheType: cacheType,
            Result: hit ? 'Hit' : 'Miss'
        }
    });
    if (key) {
        console.log(`üíæ CACHE_${hit ? 'HIT' : 'MISS'}: ${cacheType} - ${key}`);
    }
}
exports.logCacheMetric = logCacheMetric;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0cmljcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1ldHJpY3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBa0JIOztHQUVHO0FBQ0gsU0FBZ0IsU0FBUyxDQUFDLE1BQWtCO0lBQzFDLE1BQU0sUUFBUSxHQUFHO1FBQ2YsU0FBUyxFQUFFLE1BQU0sQ0FBQyxTQUFTLEVBQUUsV0FBVyxFQUFFLElBQUksSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7UUFDdEUsVUFBVSxFQUFFLGVBQWU7UUFDM0IsVUFBVSxFQUFFLE1BQU0sQ0FBQyxVQUFVO1FBQzdCLEtBQUssRUFBRSxNQUFNLENBQUMsS0FBSztRQUNuQixJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUk7UUFDakIsVUFBVSxFQUFFLE1BQU0sQ0FBQyxVQUFVLElBQUksRUFBRTtLQUNwQyxDQUFDO0lBRUYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3hELENBQUM7QUFYRCw4QkFXQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsY0FBYyxDQUFDLElBQXVCO0lBQ3BELE1BQU0sUUFBUSxHQUFHO1FBQ2YsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO1FBQ25DLFVBQVUsRUFBRSxhQUFhO1FBQ3pCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztRQUN6QixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7UUFDdkIsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1FBQ3JCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztRQUN6QixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVEsSUFBSSxFQUFFO0tBQzlCLENBQUM7SUFFRixPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUUxRCxn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QUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNO1NBQzdCO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsSUFBSSxHQUFHLEVBQUU7UUFDUCxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxTQUFTLE1BQU0sR0FBRyxFQUFFLENBQUMsQ0FBQztLQUN4RTtBQUNILENBQUM7QUFsQkQsd0NBa0JDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENsb3VkV2F0Y2ggTWV0cmljcyBhbmQgTW9uaXRvcmluZyBVdGlsaXRpZXNcclxuICogUHJvdmlkZXMgc3RydWN0dXJlZCBsb2dnaW5nIGFuZCBtZXRyaWNzIGZvciBwcm9kdWN0aW9uIG1vbml0b3JpbmdcclxuICovXHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIE1ldHJpY0RhdGEge1xyXG4gIG1ldHJpY05hbWU6IHN0cmluZztcclxuICB2YWx1ZTogbnVtYmVyO1xyXG4gIHVuaXQ6ICdDb3VudCcgfCAnU2Vjb25kcycgfCAnTWlsbGlzZWNvbmRzJyB8ICdQZXJjZW50JyB8ICdCeXRlcyc7XHJcbiAgZGltZW5zaW9ucz86IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH07XHJcbiAgdGltZXN0YW1wPzogRGF0ZTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZU1ldHJpYyB7XHJcbiAgb3BlcmF0aW9uOiBzdHJpbmc7XHJcbiAgZHVyYXRpb246IG51bWJlcjtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGVycm9yVHlwZT86IHN0cmluZztcclxuICBtZXRhZGF0YT86IHsgW2tleTogc3RyaW5nXTogYW55IH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBMb2cgc3RydWN0dXJlZCBtZXRyaWNzIGZvciBDbG91ZFdhdGNoXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbG9nTWV0cmljKG1ldHJpYzogTWV0cmljRGF0YSk6IHZvaWQge1xyXG4gIGNvbnN0IGxvZ0VudHJ5ID0ge1xyXG4gICAgdGltZXN0YW1wOiBtZXRyaWMudGltZXN0YW1wPy50b0lTT1N0cmluZygpIHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgIG1ldHJpY1R5cGU6ICdDVVNUT01fTUVUUklDJyxcclxuICAgIG1ldHJpY05hbWU6IG1ldHJpYy5tZXRyaWNOYW1lLFxyXG4gICAgdmFsdWU6IG1ldHJpYy52YWx1ZSxcclxuICAgIHVuaXQ6IG1ldHJpYy51bml0LFxyXG4gICAgZGltZW5zaW9uczogbWV0cmljLmRpbWVuc2lvbnMgfHwge30sXHJcbiAgfTtcclxuXHJcbiAgY29uc29sZS5sb2coYPCfk4ogTUVUUklDOiAke0pTT04uc3RyaW5naWZ5KGxvZ0VudHJ5KX1gKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIExvZyBwZXJmb3JtYW5jZSBtZXRyaWNzXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbG9nUGVyZm9ybWFuY2UocGVyZjogUGVyZm9ybWFuY2VNZXRyaWMpOiB2b2lkIHtcclxuICBjb25zdCBsb2dFbnRyeSA9IHtcclxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgbWV0cmljVHlwZTogJ1BFUkZPUk1BTkNFJyxcclxuICAgIG9wZXJhdGlvbjogcGVyZi5vcGVyYXRpb24sXHJcbiAgICBkdXJhdGlvbjogcGVyZi5kdXJhdGlvbixcclxuICAgIHN1Y2Nlc3M6IHBlcmYuc3VjY2VzcyxcclxuICAgIGVycm9yVHlwZTogcGVyZi5lcnJvclR5cGUsXHJcbiAgICBtZXRhZGF0YTogcGVyZi5tZXRhZGF0YSB8fCB7fSxcclxuICB9O1xyXG5cclxuICBjb25zb2xlLmxvZyhg4pqhIFBFUkZPUk1BTkNFOiAke0pTT04uc3RyaW5naWZ5KGxvZ0VudHJ5KX1gKTtcclxuXHJcbiAgLy8gQWxzbyBsb2cgYXMgQ2xvdWRXYXRjaCBtZXRyaWNcclxuICBsb2dNZXRyaWMoe1xyXG4gICAgbWV0cmljTmFtZTogYCR7cGVyZi5vcGVyYXRpb259X0R1cmF0aW9uYCxcclxuICAgIHZhbHVlOiBwZXJmLmR1cmF0aW9uLFxyXG4gICAgdW5pdDogJ01pbGxpc2Vjb25kcycsXHJcbiAgICBkaW1lbnNpb25zOiB7XHJcbiAgICAgIE9wZXJhdGlvbjogcGVyZi5vcGVyYXRpb24sXHJcbiAgICAgIFN1Y2Nlc3M6IHBlcmYuc3VjY2Vzcy50b1N0cmluZygpLFxyXG4gICAgICBFcnJvclR5cGU6IHBlcmYuZXJyb3JUeXBlIHx8ICdOb25lJ1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogQ2lyY3VpdCBCcmVha2VyIG1ldHJpY3NcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBsb2dDaXJjdWl0QnJlYWtlck1ldHJpYyhcclxuICBzZXJ2aWNlOiBzdHJpbmcsXHJcbiAgc3RhdGU6IHN0cmluZyxcclxuICBmYWlsdXJlQ291bnQ6IG51bWJlcixcclxuICBzdWNjZXNzQ291bnQ6IG51bWJlclxyXG4pOiB2b2lkIHtcclxuICBsb2dNZXRyaWMoe1xyXG4gICAgbWV0cmljTmFtZTogJ0NpcmN1aXRCcmVha2VyX1N0YXRlJyxcclxuICAgIHZhbHVlOiBzdGF0ZSA9PT0gJ09QRU4nID8gMSA6IDAsXHJcbiAgICB1bml0OiAnQ291bnQnLFxyXG4gICAgZGltZW5zaW9uczoge1xyXG4gICAgICBTZXJ2aWNlOiBzZXJ2aWNlLFxyXG4gICAgICBTdGF0ZTogc3RhdGVcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgbG9nTWV0cmljKHtcclxuICAgIG1ldHJpY05hbWU6ICdDaXJjdWl0QnJlYWtlcl9GYWlsdXJlQ291bnQnLFxyXG4gICAgdmFsdWU6IGZhaWx1cmVDb3VudCxcclxuICAgIHVuaXQ6ICdDb3VudCcsXHJcbiAgICBkaW1lbnNpb25zOiB7XHJcbiAgICAgIFNlcnZpY2U6IHNlcnZpY2VcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgbG9nTWV0cmljKHtcclxuICAgIG1ldHJpY05hbWU6ICdDaXJjdWl0QnJlYWtlcl9TdWNjZXNzQ291bnQnLFxyXG4gICAgdmFsdWU6IHN1Y2Nlc3NDb3VudCxcclxuICAgIHVuaXQ6ICdDb3VudCcsXHJcbiAgICBkaW1lbnNpb25zOiB7XHJcbiAgICAgIFNlcnZpY2U6IHNlcnZpY2VcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEJ1c2luZXNzIG1ldHJpY3MgZm9yIFRyaW5pdHlcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBsb2dCdXNpbmVzc01ldHJpYyhcclxuICBldmVudFR5cGU6ICdST09NX0NSRUFURUQnIHwgJ1JPT01fSk9JTkVEJyB8ICdWT1RFX0NBU1QnIHwgJ01BVENIX0ZPVU5EJyB8ICdBSV9SRUNPTU1FTkRBVElPTicsXHJcbiAgcm9vbUlkPzogc3RyaW5nLFxyXG4gIHVzZXJJZD86IHN0cmluZyxcclxuICBtZXRhZGF0YT86IHsgW2tleTogc3RyaW5nXTogYW55IH1cclxuKTogdm9pZCB7XHJcbiAgY29uc3QgbG9nRW50cnkgPSB7XHJcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgIG1ldHJpY1R5cGU6ICdCVVNJTkVTU19FVkVOVCcsXHJcbiAgICBldmVudFR5cGUsXHJcbiAgICByb29tSWQ6IHJvb21JZCB8fCAndW5rbm93bicsXHJcbiAgICB1c2VySWQ6IHVzZXJJZCB8fCAndW5rbm93bicsXHJcbiAgICBtZXRhZGF0YTogbWV0YWRhdGEgfHwge30sXHJcbiAgfTtcclxuXHJcbiAgY29uc29sZS5sb2coYPCfkrwgQlVTSU5FU1M6ICR7SlNPTi5zdHJpbmdpZnkobG9nRW50cnkpfWApO1xyXG5cclxuICAvLyBMb2cgYXMgQ2xvdWRXYXRjaCBtZXRyaWNcclxuICBsb2dNZXRyaWMoe1xyXG4gICAgbWV0cmljTmFtZTogYEJ1c2luZXNzXyR7ZXZlbnRUeXBlfWAsXHJcbiAgICB2YWx1ZTogMSxcclxuICAgIHVuaXQ6ICdDb3VudCcsXHJcbiAgICBkaW1lbnNpb25zOiB7XHJcbiAgICAgIEV2ZW50VHlwZTogZXZlbnRUeXBlLFxyXG4gICAgICBTdGFnZTogcHJvY2Vzcy5lbnYuU1RBR0UgfHwgJ2RldidcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEVycm9yIHRyYWNraW5nXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbG9nRXJyb3IoXHJcbiAgb3BlcmF0aW9uOiBzdHJpbmcsXHJcbiAgZXJyb3I6IEVycm9yLFxyXG4gIGNvbnRleHQ/OiB7IFtrZXk6IHN0cmluZ106IGFueSB9XHJcbik6IHZvaWQge1xyXG4gIGNvbnN0IGxvZ0VudHJ5ID0ge1xyXG4gICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICBtZXRyaWNUeXBlOiAnRVJST1InLFxyXG4gICAgb3BlcmF0aW9uLFxyXG4gICAgZXJyb3JOYW1lOiBlcnJvci5uYW1lLFxyXG4gICAgZXJyb3JNZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgZXJyb3JTdGFjazogZXJyb3Iuc3RhY2ssXHJcbiAgICBjb250ZXh0OiBjb250ZXh0IHx8IHt9LFxyXG4gIH07XHJcblxyXG4gIGNvbnNvbGUuZXJyb3IoYOKdjCBFUlJPUjogJHtKU09OLnN0cmluZ2lmeShsb2dFbnRyeSl9YCk7XHJcblxyXG4gIC8vIExvZyBhcyBDbG91ZFdhdGNoIG1ldHJpY1xyXG4gIGxvZ01ldHJpYyh7XHJcbiAgICBtZXRyaWNOYW1lOiAnRXJyb3JzJyxcclxuICAgIHZhbHVlOiAxLFxyXG4gICAgdW5pdDogJ0NvdW50JyxcclxuICAgIGRpbWVuc2lvbnM6IHtcclxuICAgICAgT3BlcmF0aW9uOiBvcGVyYXRpb24sXHJcbiAgICAgIEVycm9yVHlwZTogZXJyb3IubmFtZSxcclxuICAgICAgU3RhZ2U6IHByb2Nlc3MuZW52LlNUQUdFIHx8ICdkZXYnXHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQZXJmb3JtYW5jZSB0aW1lciB1dGlsaXR5XHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgUGVyZm9ybWFuY2VUaW1lciB7XHJcbiAgcHJpdmF0ZSBzdGFydFRpbWU6IG51bWJlcjtcclxuICBwcml2YXRlIG9wZXJhdGlvbjogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcihvcGVyYXRpb246IHN0cmluZykge1xyXG4gICAgdGhpcy5vcGVyYXRpb24gPSBvcGVyYXRpb247XHJcbiAgICB0aGlzLnN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgfVxyXG5cclxuICBmaW5pc2goc3VjY2VzczogYm9vbGVhbiA9IHRydWUsIGVycm9yVHlwZT86IHN0cmluZywgbWV0YWRhdGE/OiB7IFtrZXk6IHN0cmluZ106IGFueSB9KTogdm9pZCB7XHJcbiAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSB0aGlzLnN0YXJ0VGltZTtcclxuICAgIFxyXG4gICAgbG9nUGVyZm9ybWFuY2Uoe1xyXG4gICAgICBvcGVyYXRpb246IHRoaXMub3BlcmF0aW9uLFxyXG4gICAgICBkdXJhdGlvbixcclxuICAgICAgc3VjY2VzcyxcclxuICAgICAgZXJyb3JUeXBlLFxyXG4gICAgICBtZXRhZGF0YVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ2FjaGUgaGl0L21pc3MgbWV0cmljc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGxvZ0NhY2hlTWV0cmljKFxyXG4gIGNhY2hlVHlwZTogJ01PVklFUycgfCAnVVNFUl9QUk9GSUxFJyB8ICdST09NX0RBVEEnLFxyXG4gIGhpdDogYm9vbGVhbixcclxuICBrZXk/OiBzdHJpbmdcclxuKTogdm9pZCB7XHJcbiAgbG9nTWV0cmljKHtcclxuICAgIG1ldHJpY05hbWU6IGBDYWNoZV8ke2hpdCA/ICdIaXQnIDogJ01pc3MnfWAsXHJcbiAgICB2YWx1ZTogMSxcclxuICAgIHVuaXQ6ICdDb3VudCcsXHJcbiAgICBkaW1lbnNpb25zOiB7XHJcbiAgICAgIENhY2hlVHlwZTogY2FjaGVUeXBlLFxyXG4gICAgICBSZXN1bHQ6IGhpdCA/ICdIaXQnIDogJ01pc3MnXHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGlmIChrZXkpIHtcclxuICAgIGNvbnNvbGUubG9nKGDwn5K+IENBQ0hFXyR7aGl0ID8gJ0hJVCcgOiAnTUlTUyd9OiAke2NhY2hlVHlwZX0gLSAke2tleX1gKTtcclxuICB9XHJcbn0iXX0=